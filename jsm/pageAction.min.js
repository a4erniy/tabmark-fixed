$(document).ready(function(){action.init()});var bgPage=chrome.extension.getBackgroundPage(),db=bgPage.db,logos=bgPage.logos,_gaq=bgPage._gaq,action={tab:null,ftabs:null,furl:null,ftitle:null,screenshot:null,init:function(){action.initFTabs(),action.initFUrl(),$(".btn-save").click(action.save),$(".btn-cancel").click(action.cancel),action.ftitle.keyup(function(){slider.dom.find(".colorBased .name").text(this.value)})},initFTabs:function(){action.ftabs=$("#tab");var a="";db.store.tabs.forEach(function(b,c){var d="<option value='{id}' {selected}>{name}</option>".replace(/{id}/,b.id).replace(/{name}/,b.name);d=0==c?d.replace(/{selected}/,'selected="selected"'):d.replace(/{selected}/,""),a+=d}),action.ftabs.html(a)},initFUrl:function(){action.furl=$("#url"),action.ftitle=$("#title"),chrome.tabs.query({active:!0},function(a){action.tab=a[0],action.furl.val(a[0].url),action.ftitle.val(helper.getHostname(a[0].url,!0)).focus(),_gaq.push(["_trackEvent","dials","dials-pageAction",action.furl.val()]),slider.init()})},screenshoot:function(){action.screenshot=$("#screenshot"),chrome.tabs.captureVisibleTab(chrome.windows.WINDOW_ID_CURRENT,{format:"png"},function(a){helper.resizeImage(a,300,function(a){action.screenshot[0].src=a})})},save:function(){var a={id:Date.now(),name:action.ftitle.val(),url:action.furl.val(),tabId:1*action.ftabs.val(),order:db.store.dials.length,counter:0},b=slider.slides.eq(slider.activeSlide);a.type=b.data("type"),a.imgUrl="image"!=a.type||b.hasClass("screenshot")?b.find("img").attr("src"):b.data("src"),"gen"==a.type&&(a.bgcolor=b.css("background"),a.fcolor=b.css("color")),db.store.dials.push(a),_gaq.push(["_trackEvent","dials","dials-create",a.url.replace(/(\/+)$/,"")]),db.save("dials"),window.close()},cancel:function(){window.close()}},slider={dom:null,slides:null,colors:[],colorSlide:null,activeSlide:null,defaultColors:["#2ecc71","#1abc9c","#3498db","#f1c40f","#9b59b6","#f1c40f","#2c3e50","#e67e22","#e74c3c","#95a5a6"],init:function(){slider.dom=$(".slider"),slider.predefines(),slider.slides=slider.dom.find(".slide"),slider.setActiveSlide(2%slider.slides.length),slider.colorSlide=slider.dom.find(".slide.colorBased"),slider.colorSlide.find(".name").text(action.ftitle.val()),slider.createColorBased(),slider.dom.find(".next").click(slider.next),slider.dom.find(".prev").click(slider.prev),$(".color-switcher").on("click",".color",function(){slider.changeColor(this.dataset.id)}),action.screenshoot()},predefines:function(){var a=helper.getHostname(action.furl.val(),!0);void 0!==logos[a]&&logos[a].forEach(function(a){var b="<div class='slide predefined'  data-type='image' data-src='"+a+"' style='background-image: url("+a+") '></div>";slider.dom.append(b)})},next:function(){var a=(slider.activeSlide+1)%slider.slides.length;slider.setActiveSlide(a)},prev:function(){var a=(slider.activeSlide-1)%slider.slides.length;slider.setActiveSlide(a)},setActiveSlide:function(a){slider.activeSlide=a,slider.slides.removeClass("current"),slider.slides.eq(a).addClass("current")},createColorBased:function(){var a=action.tab.favIconUrl;if(void 0!==a){var b=new Image;b.onload=function(){slider.setColors(getTopRGB(b)),$("#favicon").attr("src",a)},b.src=a}else slider.setColors(slider.defaultColors)},setColors:function(a){slider.colors=a;var b=slider.colorSlide.find(".color-switcher");slider.colors.forEach(function(a,c){b.append("<div class='color' style='background-color: "+a+"' data-id='"+c+"'></div>")}),slider.changeColor(0)},changeColor:function(a){var b=slider.colors[a],c=slider.colorSlide;c.css("background",b),c.css("color",helper.chooseTextColor(b))}};